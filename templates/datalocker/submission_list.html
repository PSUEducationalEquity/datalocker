{# Copyright 2015 The Pennsylvania State University. Office of the Vice Provost for Educational Equity. All Rights Reserved. #}
{% extends "datalocker/app_template.html" %}
{% load staticfiles %}

{% block breadcrumb-trail %}
  <li>
    <a href="{% url 'datalocker:index' %}">
      <span class="sr-only">List of </span>My Lockers
    </a>
  </li>
  <li class="active">All Submissions
    <span class="sr-only"> for {{ locker.name }}</span>
  </li>
{% endblock breadcrumb-trail %}

{% block page-meta-title %}Submissions{% endblock page-meta-title %}


{% block site-styles %}
  {{ block.super }}
  <link type="text/css" rel="stylesheet"
        href="{% static 'datalocker/css/bootstrap-toggle.css' %}" />
{% endblock site-styles %}

{% block content %}
  <div class="container-fluid">
    {% if locker.owner = user.username %}
      <div class="onoffswitch">
        <input type="checkbox"
          id="onoffswitch"
          class="onoffswitch-checkbox"
          name="onoffswitch"
          data-size="small"
          data-toggle="toggle"
          data-onstyle="success"
          data-offstyle="danger"
          data-on="Done editing"
          data-off="Edit submissions">
      </div>
      {% endif %}
    <h1>{{ locker.name }}</h1>
    <ul class="messages list-unstyled" id="user-messages">
      {% for msg in messages %}
        <li class="alert {{ msg.tags }}">{{ msg|safe }}</li>
      {% endfor %}
      <li class="alert alert-warning" id="delete-warning">
        When you 'Delete' a submission it will be marked
        to be deleted automatically after 3 days
        giving you time to 'Undelete' a submission if needed.</li>
    </ul>
    <button type="button" class="btn btn-default btn-xs" role="filter-results">
    Select the fields to display in the table</button>
    <table class="table table-striped table-hover listing tablesorter"
      name="submission listing"
      id="submission-list"
      data-locker-id="{{locker.id}}">
      <caption>Form Submissions</caption>
      <thead>
        {% for heading in column_headings %}
          <th>{{ heading }}</th>
        {% endfor %}
        <th class="record-actions heading-display-for-submission">Delete Submissions
      </thead>
      <tbody>
        {# This is getting submissions that were submitted to the locker #}
        {% for submission in data %}
          <tr data-id="{{submission.0 }}"
            class="{% if submission.1 %}deleted{% else %}{% endif %}">
            {% for value in submission %}
              {% if forloop.counter > 2 %}
                <td>
                  {% if forloop.counter == 3 %}
                    <a href="{% url 'datalocker:submissions_view' locker.id submission.0 %}"
                      style="display:block;">{{ value }}</a>
                  {% else %}
                    {{ value }}
                  {% endif %}
                </td>
              {% endif %}
            {% endfor %}
            <td class="record-actions">
              <button type="button"
                role="delete-submission"
                class="btn btn-xs archive-button delete-submission
                {% if submission.1 %}btn-success{% else %}btn-danger{% endif %}"
                {% if submission.1 %}
                data-url="{% url 'datalocker:undelete_submission' locker.id submission.0 %}"
                {% else %}
                data-url="{% url 'datalocker:delete_submission' locker.id submission.0 %}"
                {% endif %}
                >{% if submission.1 %}Undelete{% else %}Delete{% endif %}</button>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <form method="POST" id="delete_undelete_form">
   {% csrf_token %}
  </form>
</div>
{% endblock %}


{% block dialogs %}
{# Modal for filtering out the data shown in the submission list #}
  <div class="modal fade"
    id="dialog-filter-results"
    tabindex="-1"
    role="dialog"
    aria-labelledby="dialog-filter-results-title"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="POST"
          name="modalForm"
          action="{% url 'datalocker:submissions_list' locker.id %}">
          {% csrf_token %}
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"
            id="dialog-filter-results-title">Select the form fields to display below</h4>
        </div>
        <div class="modal-body">
          <div>
            <input type="checkbox"
              id="fields-select-all"
              role="select-all"
              data-target="fields-list"/>
            <label for="fields-select-all"  class="select-all-checkbox">Select All</label>
          </div>
          <ul class="list-unstyled" id="fields-list">
          {% for field in fields_list %}
            <li>
              <input type="checkbox"
                id="{{ field|slugify }}"
                name="{{ field|slugify }}"
                class="checkbox-inputs"
                {% if field in selected_fields %}
                checked="checked" {% endif %} />
              <label for="{{ field|slugify }}">{{ field }}</label>
            </li>
          {% endfor %}
          </ul>
        </div>
        <div class="modal-footer">
          <input type="submit"
            class="btn btn-primary btn-sm pull-left"
            value="Update"/>
          <input type="button"
            class="btn btn-default btn-sm pull-left"
            value="Close"
            data-dismiss="modal">
          </button>
          </div>
        </div>
        </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}


{% block site-scripts %}
    {{ block.super }}
    <script type="text/javascript"
            src=" {% static 'datalocker/js/bootstrap-toggle.js' %}"></script>
    <script type="text/javascript"
            src=" {% static 'datalocker/js/tablesorter.js' %}"></script>
    <script type="text/javascript"
            src=" {% static 'datalocker/js/select-all.js' %}"></script>
    <script type="text/javascript"
            src=" {% static 'datalocker/js/submission.js' %}"></script>
{% endblock site-scripts %}
